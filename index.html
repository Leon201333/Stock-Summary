<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock Lookup Tool</title>
    <meta name="description" content="Look up stock prices and recent news for publicly traded companies">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üìà</text></svg>">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: #ffffff;
            min-height: 100vh;
            padding: 40px 20px;
            color: #333333;
        }

        .page-wrapper {
            display: flex;
            max-width: 1400px;
            margin: 0 auto;
            gap: 24px;
        }

        .sidebar {
            width: 220px;
            flex-shrink: 0;
            position: sticky;
            top: 20px;
            height: fit-content;
            max-height: calc(100vh - 40px);
            overflow-y: auto;
        }

        .sidebar-nav {
            background: #f8f9fa;
            border: 1px solid #e0e0e0;
            border-radius: 12px;
            padding: 16px;
        }

        .sidebar-title {
            font-size: 0.9rem;
            font-weight: 600;
            color: #666;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid #e0e0e0;
        }

        .sidebar-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .sidebar-item {
            margin-bottom: 8px;
        }

        .sidebar-link {
            display: block;
            padding: 10px 12px;
            background: #fff;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            color: #333;
            text-decoration: none;
            font-size: 0.9rem;
            transition: all 0.2s;
            cursor: pointer;
        }

        .sidebar-link:hover {
            background: #e8f4f8;
            border-color: #64ffda;
        }

        .sidebar-link .symbol {
            font-weight: 700;
            color: #0066cc;
        }

        .sidebar-link .company-name {
            font-size: 0.8rem;
            color: #666;
            display: block;
            margin-top: 2px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .sidebar-link .price-indicator {
            font-size: 0.75rem;
            margin-top: 4px;
        }

        .sidebar-link .price-up {
            color: #00a86b;
        }

        .sidebar-link .price-down {
            color: #dc3545;
        }

        .main-content {
            flex: 1;
            min-width: 0;
        }

        .container {
            max-width: 100%;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 40px;
        }

        h1 {
            font-size: 2.4rem;
            color: #333;
            margin-bottom: 8px;
        }

        .subtitle {
            color: #666;
            font-size: 1.1rem;
        }

        .search-section {
            background: #f8f9fa;
            border: 1px solid #e0e0e0;
            border-radius: 16px;
            padding: 32px;
            margin-bottom: 24px;
        }

        .search-box {
            display: flex;
            gap: 12px;
        }

        input[type="text"] {
            flex: 1;
            padding: 16px 20px;
            font-size: 1.1rem;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            background: #fff;
            color: #333;
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        input[type="text"]::placeholder {
            color: #999;
        }

        input[type="text"]:focus {
            outline: none;
            border-color: #0066cc;
            box-shadow: 0 0 0 4px rgba(0, 102, 204, 0.15);
        }

        button {
            padding: 16px 32px;
            font-size: 1.1rem;
            font-weight: 600;
            background: linear-gradient(135deg, #0066cc 0%, #0052a3 100%);
            color: #fff;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: transform 0.1s, box-shadow 0.2s;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(0, 102, 204, 0.3);
        }

        button:active {
            transform: scale(0.98);
        }

        button:disabled {
            background: #4a5568;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .search-tips {
            margin-top: 16px;
            padding: 12px 16px;
            background: rgba(100, 255, 218, 0.05);
            border-radius: 8px;
            font-size: 0.85rem;
            color: #8892b0;
        }

        .search-tips strong {
            color: #64ffda;
        }

        .quick-links {
            margin-top: 16px;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            align-items: center;
        }

        .quick-link {
            padding: 8px 16px;
            background: #fff;
            border: 1px solid #e0e0e0;
            border-radius: 20px;
            font-size: 0.9rem;
            color: #0066cc;
            cursor: pointer;
            transition: all 0.2s;
        }

        .quick-link:hover {
            background: #e8f4f8;
            border-color: #0066cc;
            color: #0052a3;
        }

        .results {
            display: none;
        }

        .results.visible {
            display: block;
        }

        .loading {
            text-align: center;
            padding: 60px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-top-color: #64ffda;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 16px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .stock-card {
            background: #f8f9fa;
            border: 1px solid #e0e0e0;
            border-radius: 16px;
            padding: 32px;
            margin-bottom: 24px;
        }

        .stock-card-header-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .stock-card-title {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .stock-card-title h2 {
            font-size: 1.4rem;
            color: #333;
            margin: 0;
        }

        .stock-card-title .symbol-badge {
            background: #0066cc;
            color: #fff;
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .stock-card-toggle {
            padding: 8px 16px;
            font-size: 0.85rem;
            font-weight: 600;
            background: #fff;
            color: #666;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .stock-card-toggle:hover {
            background: #f0f0f0;
            transform: none;
            box-shadow: none;
        }

        .stock-card-content {
            transition: all 0.3s;
        }

        .stock-card-content.collapsed {
            display: none;
        }

        .stock-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 24px;
            padding-bottom: 24px;
            border-bottom: 1px solid #e0e0e0;
        }

        .stock-info h2 {
            font-size: 1.6rem;
            color: #333;
            margin-bottom: 4px;
        }

        .stock-symbol {
            display: inline-block;
            padding: 4px 12px;
            background: #e8f4f8;
            color: #0066cc;
            border-radius: 6px;
            font-size: 0.9rem;
            font-weight: 600;
            margin-right: 8px;
        }

        .stock-exchange {
            color: #666;
            font-size: 0.9rem;
        }

        .price-container {
            text-align: right;
        }

        .current-price {
            font-size: 2.2rem;
            font-weight: 700;
            color: #333;
        }

        .price-change {
            font-size: 1.1rem;
            margin-top: 4px;
        }

        .price-change.positive {
            color: #00a86b;
        }

        .price-change.negative {
            color: #dc3545;
        }

        .stock-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 12px;
            margin-bottom: 24px;
        }

        .detail-item {
            background: #fff;
            border: 1px solid #e0e0e0;
            padding: 14px;
            border-radius: 10px;
        }

        .detail-label {
            font-size: 0.8rem;
            color: #666;
            margin-bottom: 4px;
        }

        .detail-value {
            font-size: 1rem;
            color: #333;
            font-weight: 600;
        }

        .news-section {
            border-top: 1px solid #e0e0e0;
            padding-top: 24px;
        }

        .chart-section {
            margin-bottom: 24px;
            padding-bottom: 24px;
            border-bottom: 1px solid #e0e0e0;
        }

        .chart-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
            flex-wrap: wrap;
            gap: 12px;
        }

        .chart-header h3 {
            font-size: 1.1rem;
            color: #333;
        }

        .chart-intervals {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
        }

        .interval-btn {
            padding: 6px 12px;
            font-size: 0.8rem;
            font-weight: 600;
            background: #fff;
            color: #666;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .interval-btn:hover {
            background: #e8f4f8;
            border-color: #0066cc;
            color: #0066cc;
            transform: none;
            box-shadow: none;
        }

        .interval-btn.active {
            background: #0066cc;
            border-color: #0066cc;
            color: #fff;
        }

        .chart-container {
            position: relative;
            height: 250px;
            background: #fff;
            border: 1px solid #e0e0e0;
            border-radius: 12px;
            padding: 16px;
        }

        .chart-loading {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: #666;
        }

        .news-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 16px;
            flex-wrap: wrap;
        }

        .news-header h3 {
            font-size: 1.1rem;
            color: #333;
        }

        .news-badge {
            padding: 4px 10px;
            background: #e8f4f8;
            color: #0066cc;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .news-toggle {
            margin-left: auto;
            color: #666;
            font-size: 0.85rem;
            cursor: pointer;
        }

        .news-toggle:hover {
            color: #0066cc;
        }

        .news-list {
            display: none;
        }

        .news-list.expanded {
            display: block;
        }

        .news-item {
            background: #fff;
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            padding: 16px;
            margin-bottom: 12px;
            transition: transform 0.2s, background 0.2s;
        }

        .news-item:hover {
            transform: translateX(4px);
            background: #f8f9fa;
        }

        .news-item:last-child {
            margin-bottom: 0;
        }

        .news-item a {
            text-decoration: none;
        }

        .news-title {
            font-size: 1rem;
            color: #333;
            margin-bottom: 6px;
            line-height: 1.4;
        }

        .news-title:hover {
            color: #0066cc;
        }

        .news-meta {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            font-size: 0.8rem;
            color: #666;
        }

        .news-source {
            color: #0066cc;
        }

        .no-news {
            text-align: center;
            padding: 20px;
            color: #666;
            font-size: 0.9rem;
        }

        .news-timeframe {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-left: 12px;
        }

        .news-value-input {
            width: 60px;
            padding: 6px 10px;
            font-size: 0.85rem;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            background: #fff;
            color: #333;
            text-align: center;
        }

        .news-value-input:focus {
            outline: none;
            border-color: #0066cc;
        }

        .news-unit-select {
            padding: 6px 10px;
            font-size: 0.85rem;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            background: #fff;
            color: #333;
            cursor: pointer;
        }

        .news-unit-select:focus {
            outline: none;
            border-color: #0066cc;
        }

        .news-unit-select option {
            background: #fff;
            color: #333;
        }

        .news-refresh-btn {
            padding: 6px 12px;
            font-size: 0.8rem;
            font-weight: 600;
            background: #e8f4f8;
            color: #0066cc;
            border: 1px solid #0066cc;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .news-refresh-btn:hover {
            background: #d0e8f0;
            transform: none;
            box-shadow: none;
        }

        .price-history-controls {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-left: auto;
        }

        .price-history-input {
            width: 70px;
            padding: 8px 10px;
            font-size: 0.9rem;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            background: #fff;
            color: #333;
            text-align: center;
        }

        .price-history-input:focus {
            outline: none;
            border-color: #0066cc;
        }

        .price-history-select {
            padding: 8px 12px;
            font-size: 0.9rem;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            background: #fff;
            color: #333;
            cursor: pointer;
        }

        .price-history-select:focus {
            outline: none;
            border-color: #0066cc;
        }

        .price-history-select option {
            background: #fff;
            color: #333;
        }

        .price-history-btn {
            padding: 8px 16px;
            font-size: 0.9rem;
            font-weight: 600;
            background: linear-gradient(135deg, #0066cc 0%, #0052a3 100%);
            color: #fff;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .price-history-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 10px rgba(0, 102, 204, 0.3);
        }

        .price-history-toggle-btn {
            padding: 8px 12px;
            font-size: 0.9rem;
            font-weight: 600;
            background: #fff;
            color: #666;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .price-history-toggle-btn:hover {
            background: #f0f0f0;
            transform: none;
            box-shadow: none;
        }

        .price-history-container {
            margin-top: 16px;
        }

        .price-history-container.collapsed {
            display: none;
        }

        .price-chart-wrapper {
            background: #fff;
            border: 1px solid #e0e0e0;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
            height: 250px;
        }

        .price-table-wrapper {
            max-height: 300px;
            overflow-y: auto;
            border-radius: 12px;
            background: #fff;
            border: 1px solid #e0e0e0;
        }

        .price-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }

        .price-table th {
            position: sticky;
            top: 0;
            background: #f8f9fa;
            padding: 12px 16px;
            text-align: left;
            color: #0066cc;
            font-weight: 600;
            border-bottom: 1px solid #e0e0e0;
        }

        .price-table td {
            padding: 10px 16px;
            border-bottom: 1px solid #f0f0f0;
            color: #333;
        }

        .price-table tr:hover {
            background: #f8f9fa;
        }

        .price-table .price-up {
            color: #00a86b;
        }

        .price-table .price-down {
            color: #dc3545;
        }

        .price-table .change-cell {
            font-weight: 600;
        }

        .error-box {
            background: #fff5f5;
            border: 1px solid #dc3545;
            border-radius: 12px;
            padding: 24px;
            text-align: center;
            color: #dc3545;
            margin-bottom: 24px;
        }

        .summary-bar {
            background: #f8f9fa;
            border: 1px solid #e0e0e0;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 24px;
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 16px;
        }

        .summary-item {
            text-align: center;
        }

        .summary-label {
            font-size: 0.8rem;
            color: #666;
            margin-bottom: 4px;
        }

        .summary-value {
            font-size: 1.2rem;
            font-weight: 600;
            color: #333;
        }

        .disclaimer {
            margin-top: 32px;
            padding: 20px;
            background: #f8f9fa;
            border: 1px solid #e0e0e0;
            border-radius: 12px;
            font-size: 0.85rem;
            color: #666;
            line-height: 1.6;
        }

        .api-note {
            margin-top: 16px;
            padding: 16px;
            background: #e8f4f8;
            border: 1px solid #0066cc;
            border-radius: 12px;
            font-size: 0.85rem;
            color: #0066cc;
        }

        /* Autocomplete styles */
        .search-wrapper {
            position: relative;
            flex: 1;
        }

        .autocomplete-list {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: #fff;
            border: 1px solid #e0e0e0;
            border-radius: 12px;
            margin-top: 8px;
            max-height: 300px;
            overflow-y: auto;
            z-index: 100;
            display: none;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }

        .autocomplete-list.visible {
            display: block;
        }

        .autocomplete-item {
            padding: 12px 16px;
            cursor: pointer;
            border-bottom: 1px solid #f0f0f0;
            transition: background 0.2s;
        }

        .autocomplete-item:hover {
            background: #e8f4f8;
        }

        .autocomplete-item:last-child {
            border-bottom: none;
        }

        .autocomplete-symbol {
            font-weight: 600;
            color: #0066cc;
            margin-right: 8px;
        }

        .autocomplete-name {
            color: #333;
        }

        .autocomplete-type {
            font-size: 0.8rem;
            color: #666;
            margin-left: 8px;
        }

        @media (max-width: 900px) {
            .page-wrapper {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                position: static;
                max-height: none;
                margin-bottom: 20px;
            }
            
            .sidebar-list {
                display: flex;
                flex-wrap: wrap;
                gap: 8px;
            }
            
            .sidebar-item {
                margin-bottom: 0;
            }
            
            .sidebar-link {
                padding: 8px 12px;
            }
            
            .sidebar-link .company-name {
                display: none;
            }
        }

        @media (max-width: 600px) {
            .search-box {
                flex-direction: column;
            }
            
            button {
                width: 100%;
            }

            h1 {
                font-size: 1.8rem;
            }

            .stock-header {
                flex-direction: column;
            }

            .price-container {
                text-align: left;
            }

            .current-price {
                font-size: 1.8rem;
            }

            .summary-bar {
                justify-content: center;
            }
            
            .stock-card-header-row {
                flex-direction: column;
                align-items: flex-start;
                gap: 12px;
            }
            
            .price-history-controls {
                flex-wrap: wrap;
            }
        }
    </style>
</head>
<body>
    <div class="page-wrapper">
        <aside class="sidebar" id="sidebar">
            <nav class="sidebar-nav">
                <div class="sidebar-title">üìä Companies</div>
                <ul class="sidebar-list" id="sidebarList">
                    <li class="sidebar-item" style="color: #666; font-size: 0.85rem; padding: 10px;">Search for stocks to see them here</li>
                </ul>
            </nav>
        </aside>
        
        <main class="main-content">
            <div class="container">
                <header>
                    <h1>üìà Stock Lookup</h1>
                    <p class="subtitle">Search by company name or stock symbol</p>
                </header>

                <div class="search-section">
                    <div class="search-box">
                        <div class="search-wrapper">
                            <input type="text" id="searchInput" placeholder="Enter symbols or company names (e.g., AAPL, Microsoft, TSLA)..." autofocus>
                            <div class="autocomplete-list" id="autocompleteList"></div>
                        </div>
                        <button id="searchBtn" onclick="searchStocks()">Search</button>
                    </div>
                    <div class="search-tips">
                        <strong>üí° Tip:</strong> Search multiple stocks by separating them with commas: <strong>AAPL, MSFT, Google</strong>
                    </div>
                    <div class="quick-links">
                        <span style="color: #666; font-size: 0.9rem; margin-right: 8px;">Popular:</span>
                        <button class="quick-link" onclick="quickSearch('AAPL')">Apple</button>
                        <button class="quick-link" onclick="quickSearch('MSFT')">Microsoft</button>
                        <button class="quick-link" onclick="quickSearch('GOOGL')">Google</button>
                        <button class="quick-link" onclick="quickSearch('AMZN')">Amazon</button>
                        <button class="quick-link" onclick="quickSearch('TSLA')">Tesla</button>
                        <button class="quick-link" onclick="quickSearch('NVDA')">Nvidia</button>
                        <button class="quick-link" onclick="quickSearch('AAPL, MSFT, GOOGL')">Compare Big Tech</button>
                    </div>
                </div>

                <div class="results" id="results"></div>

                <div class="disclaimer">
                    <strong>‚ö†Ô∏è Disclaimer:</strong> This tool is for informational purposes only. Stock prices may be delayed. This is not financial advice. Always do your own research and consult with a financial advisor before making investment decisions.
                </div>

                <div class="api-note">
                    <strong>üì° Data Sources:</strong> Stock data and news from Finnhub API. Price history from Alpha Vantage API.
                </div>
            </div>
        </main>
    </div>

    <script>
        const FINNHUB_API_KEY = 'd5nj9g9r01ql6sfrt8tgd5nj9g9r01ql6sfrt8u0';
        let searchTimeout = null;
        
        // Store chart instances to destroy them before creating new ones

        // Symbol search for autocomplete
        async function searchSymbol(query) {
            try {
                const response = await fetch(`https://finnhub.io/api/v1/search?q=${encodeURIComponent(query)}&token=${FINNHUB_API_KEY}`);
                const data = await response.json();
                return data.result || [];
            } catch (error) {
                console.error('Symbol search error:', error);
                return [];
            }
        }

        // Autocomplete functionality
        document.getElementById('searchInput').addEventListener('input', function(e) {
            const value = e.target.value.trim();
            
            // Get the last term after comma for autocomplete
            const terms = value.split(',');
            const lastTerm = terms[terms.length - 1].trim();
            
            if (searchTimeout) clearTimeout(searchTimeout);
            
            if (lastTerm.length < 1) {
                document.getElementById('autocompleteList').classList.remove('visible');
                return;
            }

            searchTimeout = setTimeout(async () => {
                const results = await searchSymbol(lastTerm);
                displayAutocomplete(results, terms.slice(0, -1).join(', '));
            }, 300);
        });

        function displayAutocomplete(results, previousTerms) {
            const list = document.getElementById('autocompleteList');
            
            if (results.length === 0) {
                list.classList.remove('visible');
                return;
            }

            // Filter to show only common stock types
            const filtered = results.filter(r => 
                r.type === 'Common Stock' || r.type === 'ADR' || r.type === 'ETF'
            ).slice(0, 8);

            if (filtered.length === 0) {
                list.classList.remove('visible');
                return;
            }

            list.innerHTML = filtered.map(item => `
                <div class="autocomplete-item" onclick="selectAutocomplete('${item.symbol}', '${previousTerms}')">
                    <span class="autocomplete-symbol">${item.symbol}</span>
                    <span class="autocomplete-name">${escapeHtml(item.description)}</span>
                    <span class="autocomplete-type">${item.type}</span>
                </div>
            `).join('');

            list.classList.add('visible');
        }

        function selectAutocomplete(symbol, previousTerms) {
            const input = document.getElementById('searchInput');
            if (previousTerms) {
                input.value = previousTerms + ', ' + symbol;
            } else {
                input.value = symbol;
            }
            document.getElementById('autocompleteList').classList.remove('visible');
            input.focus();
        }

        // Hide autocomplete when clicking outside
        document.addEventListener('click', function(e) {
            if (!e.target.closest('.search-wrapper')) {
                document.getElementById('autocompleteList').classList.remove('visible');
            }
        });

        async function searchStocks() {
            const input = document.getElementById('searchInput').value.trim();
            const resultsDiv = document.getElementById('results');
            const searchBtn = document.getElementById('searchBtn');

            if (!input) {
                resultsDiv.classList.remove('visible');
                return;
            }

            // Parse multiple symbols/names separated by commas
            const queries = input.split(',').map(q => q.trim()).filter(q => q.length > 0);

            // Show loading
            searchBtn.disabled = true;
            searchBtn.textContent = 'Searching...';
            resultsDiv.classList.add('visible');
            resultsDiv.innerHTML = `
                <div class="loading">
                    <div class="spinner"></div>
                    <p>Fetching stock data for ${queries.length} ${queries.length === 1 ? 'company' : 'companies'}...</p>
                </div>
            `;

            const results = [];
            const errors = [];

            for (const query of queries) {
                try {
                    // First, try to find the symbol if it's a company name
                    let symbol = query.toUpperCase();
                    
                    // Check if it looks like a symbol (all caps, short) or a name
                    if (query.length > 5 || query.includes(' ') || !/^[A-Z]+$/.test(query.toUpperCase())) {
                        // Probably a company name, search for symbol
                        const searchResults = await searchSymbol(query);
                        const stockResult = searchResults.find(r => 
                            r.type === 'Common Stock' || r.type === 'ADR'
                        );
                        if (stockResult) {
                            symbol = stockResult.symbol;
                        }
                    }

                    // Get stock quote
                    const quoteResponse = await fetch(`https://finnhub.io/api/v1/quote?symbol=${symbol}&token=${FINNHUB_API_KEY}`);
                    const quoteData = await quoteResponse.json();

                    // Get company profile
                    const profileResponse = await fetch(`https://finnhub.io/api/v1/stock/profile2?symbol=${symbol}&token=${FINNHUB_API_KEY}`);
                    const profileData = await profileResponse.json();

                    // Check if we got valid data
                    if (!quoteData.c || quoteData.c === 0) {
                        errors.push(query);
                        continue;
                    }

                    // Get news (last 7 days)
                    const today = new Date();
                    const weekAgo = new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000);
                    const toDate = today.toISOString().split('T')[0];
                    const fromDate = weekAgo.toISOString().split('T')[0];

                    const newsResponse = await fetch(`https://finnhub.io/api/v1/company-news?symbol=${symbol}&from=${fromDate}&to=${toDate}&token=${FINNHUB_API_KEY}`);
                    const newsData = await newsResponse.json();

                    results.push({
                        symbol,
                        query,
                        quote: quoteData,
                        profile: profileData,
                        news: newsData
                    });

                    // Small delay to avoid rate limiting
                    await new Promise(resolve => setTimeout(resolve, 200));

                } catch (error) {
                    errors.push(query);
                }
            }

            displayResults(results, errors);
            searchBtn.disabled = false;
            searchBtn.textContent = 'Search';
        }

        function displayResults(results, errors) {
            const resultsDiv = document.getElementById('results');

            if (results.length === 0) {
                resultsDiv.innerHTML = `
                    <div class="error-box">
                        <h3 style="margin-bottom: 12px;">No Results Found</h3>
                        <p>Could not find stock data for the requested ${errors.length === 1 ? 'company' : 'companies'}.</p>
                        <p style="margin-top: 12px; font-size: 0.9rem; color: #a0aec0;">
                            Make sure you're using correct stock symbols or company names.
                        </p>
                    </div>
                `;
                return;
            }

            let html = '';

            // Show errors if any
            if (errors.length > 0) {
                html += `
                    <div class="error-box">
                        <p>Could not find data for: <strong>${errors.join(', ')}</strong></p>
                    </div>
                `;
            }

            // Summary bar if multiple stocks
            if (results.length > 1) {
                const gainers = results.filter(r => r.quote.d >= 0).length;
                const losers = results.length - gainers;
                const avgChange = (results.reduce((sum, r) => sum + (r.quote.dp || 0), 0) / results.length).toFixed(2);

                html += `
                    <div class="summary-bar">
                        <div class="summary-item">
                            <div class="summary-label">Companies</div>
                            <div class="summary-value">${results.length}</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-label">Gainers</div>
                            <div class="summary-value" style="color: #00a86b;">‚Üë ${gainers}</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-label">Losers</div>
                            <div class="summary-value" style="color: #dc3545;">‚Üì ${losers}</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-label">Avg Change</div>
                            <div class="summary-value" style="color: ${avgChange >= 0 ? '#00a86b' : '#dc3545'};">${avgChange >= 0 ? '+' : ''}${avgChange}%</div>
                        </div>
                    </div>
                `;
            }

            // Build sidebar navigation
            let sidebarHTML = '';
            results.forEach((result, index) => {
                const { symbol, quote, profile } = result;
                const companyName = profile.name || symbol;
                const changePercent = quote.dp?.toFixed(2) || 0;
                const isPositive = changePercent >= 0;
                const changeClass = isPositive ? 'price-up' : 'price-down';
                const changeSymbol = isPositive ? '+' : '';
                
                sidebarHTML += `
                    <li class="sidebar-item">
                        <div class="sidebar-link" onclick="scrollToStock(${index})">
                            <span class="symbol">${symbol}</span>
                            <span class="company-name">${escapeHtml(companyName)}</span>
                            <div class="price-indicator ${changeClass}">${changeSymbol}${changePercent}%</div>
                        </div>
                    </li>
                `;
            });
            document.getElementById('sidebarList').innerHTML = sidebarHTML;

            // Individual stock cards
            results.forEach((result, index) => {
                const { symbol, quote, profile, news } = result;

                const companyName = profile.name || symbol;
                const exchange = profile.exchange || 'N/A';
                const industry = profile.finnhubIndustry || 'N/A';

                const currentPrice = quote.c?.toFixed(2) || 'N/A';
                const change = quote.d?.toFixed(2) || 0;
                const changePercent = quote.dp?.toFixed(2) || 0;
                const highPrice = quote.h?.toFixed(2) || 'N/A';
                const lowPrice = quote.l?.toFixed(2) || 'N/A';
                const openPrice = quote.o?.toFixed(2) || 'N/A';
                const prevClose = quote.pc?.toFixed(2) || 'N/A';

                const isPositive = change >= 0;
                const changeClass = isPositive ? 'positive' : 'negative';
                const changeSymbol = isPositive ? '+' : '';

                // Build news HTML
                let newsHTML = '';
                if (news && news.length > 0) {
                    const recentNews = news.slice(0, 5);
                    newsHTML = recentNews.map(article => {
                        const date = new Date(article.datetime * 1000).toLocaleDateString('en-US', {
                            month: 'short',
                            day: 'numeric'
                        });
                        return `
                            <div class="news-item">
                                <a href="${article.url}" target="_blank" rel="noopener">
                                    <h4 class="news-title">${escapeHtml(article.headline)}</h4>
                                </a>
                                <div class="news-meta">
                                    <span class="news-source">${escapeHtml(article.source)}</span>
                                    <span>üìÖ ${date}</span>
                                </div>
                            </div>
                        `;
                    }).join('');
                } else {
                    newsHTML = `<div class="no-news">No recent news found.</div>`;
                }

                html += `
                    <div class="stock-card" id="stockCard${index}">
                        <div class="stock-card-header-row">
                            <div class="stock-card-title">
                                <h2>${escapeHtml(companyName)}</h2>
                                <span class="symbol-badge">${symbol}</span>
                            </div>
                            <button class="stock-card-toggle" onclick="toggleStockCard(${index})">Hide</button>
                        </div>
                        <div class="stock-card-content" id="stockCardContent${index}">
                            <div class="stock-header">
                                <div class="stock-info">
                                    <div>
                                        <span class="stock-symbol">${symbol}</span>
                                        <span class="stock-exchange">${escapeHtml(exchange)}</span>
                                    </div>
                                    ${industry !== 'N/A' ? `<p style="color: #666; margin-top: 8px; font-size: 0.85rem;">${escapeHtml(industry)}</p>` : ''}
                                </div>
                                <div class="price-container">
                                    <div class="current-price">$${currentPrice}</div>
                                    <div class="price-change ${changeClass}">
                                        ${changeSymbol}${change} (${changeSymbol}${changePercent}%)
                                    </div>
                                </div>
                            </div>
                            <div class="stock-details">
                                <div class="detail-item">
                                    <div class="detail-label">Open</div>
                                    <div class="detail-value">$${openPrice}</div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-label">Previous Close</div>
                                    <div class="detail-value">$${prevClose}</div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-label">Day High</div>
                                    <div class="detail-value">$${highPrice}</div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-label">Day Low</div>
                                    <div class="detail-value">$${lowPrice}</div>
                                </div>
                            </div>
                            <div class="chart-section">
                                <div class="chart-header">
                                    <h3>üìä Price History</h3>
                                    <div class="price-history-controls">
                                        <input type="number" id="priceHistoryValue${index}" class="price-history-input" value="30" min="1" max="365">
                                        <select id="priceHistoryUnit${index}" class="price-history-select">
                                        <option value="days" selected>Days</option>
                                        <option value="months">Months</option>
                                    </select>
                                    <button class="price-history-btn" onclick="loadPriceHistory('${symbol}', ${index})">Load</button>
                                    <button class="price-history-toggle-btn" id="priceHistoryToggle${index}" onclick="togglePriceHistory(${index})" style="display: none;">Hide</button>
                                </div>
                            </div>
                            <div class="price-history-container" id="priceHistoryContainer${index}">
                                <div class="chart-loading">Select timeframe and click Load</div>
                            </div>
                        </div>
                        <div class="news-section">
                            <div class="news-header">
                                <h3>üì∞ Recent News</h3>
                                <div class="news-timeframe">
                                    <input type="number" id="newsValue${index}" class="news-value-input" value="7" min="1" max="99">
                                    <select id="newsUnit${index}" class="news-unit-select">
                                        <option value="days" selected>Days</option>
                                        <option value="weeks">Weeks</option>
                                        <option value="months">Months</option>
                                    </select>
                                    <button class="news-refresh-btn" onclick="refreshNews('${symbol}', ${index})">Refresh</button>
                                </div>
                                <span class="news-badge" id="newsBadge${index}">${news ? news.length : 0} articles</span>
                                <span class="news-toggle" id="newsToggle${index}" onclick="toggleNews(${index})">‚ñº Show</span>
                            </div>
                            <div class="news-list" id="newsList${index}">
                                ${newsHTML}
                            </div>
                        </div>
                        </div>
                    </div>
                `;
            });

            resultsDiv.innerHTML = html;
        }

        // Store chart instances
        const chartInstances = {};

        async function loadPriceHistory(symbol, index) {
            const valueInput = document.getElementById(`priceHistoryValue${index}`);
            const unitSelect = document.getElementById(`priceHistoryUnit${index}`);
            const container = document.getElementById(`priceHistoryContainer${index}`);
            
            const value = parseInt(valueInput.value) || 30;
            const unit = unitSelect.value;
            
            // Calculate number of days
            let totalDays;
            if (unit === 'days') {
                totalDays = value;
            } else if (unit === 'months') {
                totalDays = value * 30;
            }
            
            // Show loading
            container.innerHTML = '<div class="chart-loading">Loading price history...</div>';
            
            try {
                // Use Alpha Vantage API for daily prices
                const ALPHA_VANTAGE_KEY = 'R760L61D4G26M6E6'; // Replace with your free API key from alphavantage.co
                const response = await fetch(`https://www.alphavantage.co/query?function=TIME_SERIES_DAILY&symbol=${symbol}&outputsize=compact&apikey=${ALPHA_VANTAGE_KEY}`);
                const data = await response.json();
                
                // Check for errors
                if (data['Error Message']) {
                    container.innerHTML = '<div class="chart-loading">Invalid symbol or API error</div>';
                    return;
                }
                
                if (data['Note']) {
                    container.innerHTML = '<div class="chart-loading">API rate limit reached. Please wait and try again.</div>';
                    return;
                }
                
                const timeSeries = data['Time Series (Daily)'];
                if (!timeSeries) {
                    container.innerHTML = '<div class="chart-loading">No data available. Get a free API key from alphavantage.co</div>';
                    return;
                }
                
                // Process data
                const allDates = Object.keys(timeSeries).sort().reverse(); // Most recent first
                const limitedDates = allDates.slice(0, totalDays);
                
                const prices = [];
                for (let i = 0; i < limitedDates.length; i++) {
                    const dateStr = limitedDates[i];
                    const dayData = timeSeries[dateStr];
                    const close = parseFloat(dayData['4. close']);
                    const open = parseFloat(dayData['1. open']);
                    const high = parseFloat(dayData['2. high']);
                    const low = parseFloat(dayData['3. low']);
                    const volume = parseInt(dayData['5. volume']);
                    
                    // Get previous close for change calculation
                    const prevDateStr = limitedDates[i + 1];
                    const prevClose = prevDateStr ? parseFloat(timeSeries[prevDateStr]['4. close']) : close;
                    const change = close - prevClose;
                    const changePercent = ((change / prevClose) * 100);
                    
                    prices.push({
                        date: new Date(dateStr),
                        dateStr: new Date(dateStr).toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' }),
                        open: open,
                        high: high,
                        low: low,
                        close: close,
                        volume: volume,
                        change: change,
                        changePercent: changePercent
                    });
                }
                
                if (prices.length === 0) {
                    container.innerHTML = '<div class="chart-loading">No data available for this timeframe</div>';
                    return;
                }
                
                // Table data (most recent first - already sorted)
                const tableData = prices;
                
                // Chart data (oldest first for proper timeline)
                const chartData = [...prices].reverse();
                
                // Build HTML
                let html = `
                    <div class="price-chart-wrapper">
                        <canvas id="priceChart${index}"></canvas>
                    </div>
                    <div class="price-table-wrapper">
                        <table class="price-table">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Close</th>
                                    <th>Open</th>
                                    <th>High</th>
                                    <th>Low</th>
                                    <th>Change</th>
                                    <th>% Change</th>
                                </tr>
                            </thead>
                            <tbody>
                `;
                
                tableData.forEach(p => {
                    const changeClass = p.change >= 0 ? 'price-up' : 'price-down';
                    const changeSymbol = p.change >= 0 ? '+' : '';
                    html += `
                        <tr>
                            <td>${p.dateStr}</td>
                            <td>$${p.close.toFixed(2)}</td>
                            <td>$${p.open.toFixed(2)}</td>
                            <td>$${p.high.toFixed(2)}</td>
                            <td>$${p.low.toFixed(2)}</td>
                            <td class="change-cell ${changeClass}">${changeSymbol}$${p.change.toFixed(2)}</td>
                            <td class="change-cell ${changeClass}">${changeSymbol}${p.changePercent.toFixed(2)}%</td>
                        </tr>
                    `;
                });
                
                html += `
                            </tbody>
                        </table>
                    </div>
                `;
                
                container.innerHTML = html;
                
                // Show the toggle button
                document.getElementById(`priceHistoryToggle${index}`).style.display = 'inline-block';
                
                // Create chart
                const canvas = document.getElementById(`priceChart${index}`);
                
                // Destroy existing chart if any
                if (chartInstances[index]) {
                    chartInstances[index].destroy();
                }
                
                // Format labels
                const labels = chartData.map(p => p.date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }));
                const closePrices = chartData.map(p => p.close);
                
                // Determine color based on overall trend
                const firstPrice = closePrices[0];
                const lastPrice = closePrices[closePrices.length - 1];
                const isPositive = lastPrice >= firstPrice;
                const lineColor = isPositive ? '#64ffda' : '#ff6b6b';
                const bgColor = isPositive ? 'rgba(100, 255, 218, 0.1)' : 'rgba(255, 107, 107, 0.1)';
                
                chartInstances[index] = new Chart(canvas, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Close Price',
                            data: closePrices,
                            borderColor: lineColor,
                            backgroundColor: bgColor,
                            borderWidth: 2,
                            fill: true,
                            tension: 0.1,
                            pointRadius: 0,
                            pointHoverRadius: 4,
                            pointHoverBackgroundColor: lineColor
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        interaction: {
                            intersect: false,
                            mode: 'index'
                        },
                        plugins: {
                            legend: {
                                display: false
                            },
                            tooltip: {
                                backgroundColor: 'rgba(26, 26, 46, 0.9)',
                                titleColor: '#fff',
                                bodyColor: '#64ffda',
                                borderColor: 'rgba(255, 255, 255, 0.1)',
                                borderWidth: 1,
                                callbacks: {
                                    label: function(context) {
                                        return 'Close: $' + context.parsed.y.toFixed(2);
                                    }
                                }
                            }
                        },
                        scales: {
                            x: {
                                display: true,
                                grid: {
                                    color: 'rgba(255, 255, 255, 0.05)'
                                },
                                ticks: {
                                    color: '#8892b0',
                                    maxTicksLimit: 8,
                                    font: {
                                        size: 10
                                    }
                                }
                            },
                            y: {
                                display: true,
                                grid: {
                                    color: 'rgba(255, 255, 255, 0.05)'
                                },
                                ticks: {
                                    color: '#8892b0',
                                    font: {
                                        size: 10
                                    },
                                    callback: function(value) {
                                        return '$' + value.toFixed(2);
                                    }
                                }
                            }
                        }
                    }
                });
                
            } catch (error) {
                container.innerHTML = '<div class="chart-loading">Error loading price history. Check console for details.</div>';
                console.error('Price history error:', error);
            }
        }

        function togglePriceHistory(index) {
            const container = document.getElementById(`priceHistoryContainer${index}`);
            const toggleBtn = document.getElementById(`priceHistoryToggle${index}`);
            
            if (container.classList.contains('collapsed')) {
                container.classList.remove('collapsed');
                toggleBtn.textContent = 'Hide';
            } else {
                container.classList.add('collapsed');
                toggleBtn.textContent = 'Show';
            }
        }

        function toggleStockCard(index) {
            const content = document.getElementById(`stockCardContent${index}`);
            const card = document.getElementById(`stockCard${index}`);
            const toggleBtn = card.querySelector('.stock-card-toggle');
            
            if (content.classList.contains('collapsed')) {
                content.classList.remove('collapsed');
                toggleBtn.textContent = 'Hide';
            } else {
                content.classList.add('collapsed');
                toggleBtn.textContent = 'Show';
            }
        }

        function scrollToStock(index) {
            const card = document.getElementById(`stockCard${index}`);
            if (card) {
                card.scrollIntoView({ behavior: 'smooth', block: 'start' });
                // Ensure it's expanded
                const content = document.getElementById(`stockCardContent${index}`);
                const toggleBtn = card.querySelector('.stock-card-toggle');
                if (content.classList.contains('collapsed')) {
                    content.classList.remove('collapsed');
                    toggleBtn.textContent = 'Hide';
                }
            }
        }

        function toggleNews(index) {
            const newsList = document.getElementById(`newsList${index}`);
            const newsToggle = document.getElementById(`newsToggle${index}`);
            
            if (newsList.classList.contains('expanded')) {
                newsList.classList.remove('expanded');
                newsToggle.textContent = '‚ñº Show';
            } else {
                newsList.classList.add('expanded');
                newsToggle.textContent = '‚ñ≤ Hide';
            }
        }

        async function refreshNews(symbol, index) {
            const valueInput = document.getElementById(`newsValue${index}`);
            const unitSelect = document.getElementById(`newsUnit${index}`);
            const newsList = document.getElementById(`newsList${index}`);
            const newsBadge = document.getElementById(`newsBadge${index}`);
            
            const value = parseInt(valueInput.value) || 7;
            const unit = unitSelect.value;
            
            // Calculate the from date based on selection
            const today = new Date();
            let fromDate = new Date();
            
            if (unit === 'days') {
                fromDate.setDate(today.getDate() - value);
            } else if (unit === 'weeks') {
                fromDate.setDate(today.getDate() - (value * 7));
            } else if (unit === 'months') {
                fromDate.setMonth(today.getMonth() - value);
            }
            
            const toDateStr = today.toISOString().split('T')[0];
            const fromDateStr = fromDate.toISOString().split('T')[0];
            
            // Show loading state
            newsList.innerHTML = '<div class="no-news">Loading news...</div>';
            newsList.classList.add('expanded');
            document.getElementById(`newsToggle${index}`).textContent = '‚ñ≤ Hide';
            
            try {
                const newsResponse = await fetch(`https://finnhub.io/api/v1/company-news?symbol=${symbol}&from=${fromDateStr}&to=${toDateStr}&token=${FINNHUB_API_KEY}`);
                const news = await newsResponse.json();
                
                // Update badge
                newsBadge.textContent = `${news.length} articles`;
                
                // Build news HTML
                let newsHTML = '';
                if (news && news.length > 0) {
                    const recentNews = news.slice(0, 5);
                    newsHTML = recentNews.map(article => {
                        const date = new Date(article.datetime * 1000).toLocaleDateString('en-US', {
                            month: 'short',
                            day: 'numeric'
                        });
                        return `
                            <div class="news-item">
                                <a href="${article.url}" target="_blank" rel="noopener">
                                    <h4 class="news-title">${escapeHtml(article.headline)}</h4>
                                </a>
                                <div class="news-meta">
                                    <span class="news-source">${escapeHtml(article.source)}</span>
                                    <span>üìÖ ${date}</span>
                                </div>
                            </div>
                        `;
                    }).join('');
                } else {
                    newsHTML = `<div class="no-news">No news found for the selected timeframe.</div>`;
                }
                
                newsList.innerHTML = newsHTML;
                
            } catch (error) {
                newsList.innerHTML = '<div class="no-news">Error loading news. Please try again.</div>';
            }
        }

        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function quickSearch(query) {
            document.getElementById('searchInput').value = query;
            searchStocks();
        }

        // Enter key to search
        document.getElementById('searchInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                document.getElementById('autocompleteList').classList.remove('visible');
                searchStocks();
            }
        });
    </script>
</body>
</html>
