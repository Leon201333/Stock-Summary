<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock Lookup Tool</title>
    <meta name="description" content="Look up stock prices and recent news for publicly traded companies">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üìà</text></svg>">
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            padding: 40px 20px;
            color: #e0e0e0;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 40px;
        }

        h1 {
            font-size: 2.4rem;
            color: #fff;
            margin-bottom: 8px;
        }

        .subtitle {
            color: #8892b0;
            font-size: 1.1rem;
        }

        .search-section {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 32px;
            margin-bottom: 24px;
        }

        .search-box {
            display: flex;
            gap: 12px;
        }

        input[type="text"] {
            flex: 1;
            padding: 16px 20px;
            font-size: 1.1rem;
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.05);
            color: #fff;
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        input[type="text"]::placeholder {
            color: #8892b0;
        }

        input[type="text"]:focus {
            outline: none;
            border-color: #64ffda;
            box-shadow: 0 0 0 4px rgba(100, 255, 218, 0.15);
        }

        button {
            padding: 16px 32px;
            font-size: 1.1rem;
            font-weight: 600;
            background: linear-gradient(135deg, #64ffda 0%, #48c9b0 100%);
            color: #1a1a2e;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: transform 0.1s, box-shadow 0.2s;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(100, 255, 218, 0.3);
        }

        button:active {
            transform: scale(0.98);
        }

        button:disabled {
            background: #4a5568;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .search-tips {
            margin-top: 16px;
            padding: 12px 16px;
            background: rgba(100, 255, 218, 0.05);
            border-radius: 8px;
            font-size: 0.85rem;
            color: #8892b0;
        }

        .search-tips strong {
            color: #64ffda;
        }

        .quick-links {
            margin-top: 16px;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            align-items: center;
        }

        .quick-link {
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            font-size: 0.9rem;
            color: #8892b0;
            cursor: pointer;
            transition: all 0.2s;
        }

        .quick-link:hover {
            background: rgba(100, 255, 218, 0.1);
            border-color: #64ffda;
            color: #64ffda;
        }

        .results {
            display: none;
        }

        .results.visible {
            display: block;
        }

        .loading {
            text-align: center;
            padding: 60px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-top-color: #64ffda;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 16px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .stock-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 32px;
            margin-bottom: 24px;
        }

        .stock-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 24px;
            padding-bottom: 24px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .stock-info h2 {
            font-size: 1.6rem;
            color: #fff;
            margin-bottom: 4px;
        }

        .stock-symbol {
            display: inline-block;
            padding: 4px 12px;
            background: rgba(100, 255, 218, 0.1);
            color: #64ffda;
            border-radius: 6px;
            font-size: 0.9rem;
            font-weight: 600;
            margin-right: 8px;
        }

        .stock-exchange {
            color: #8892b0;
            font-size: 0.9rem;
        }

        .price-container {
            text-align: right;
        }

        .current-price {
            font-size: 2.2rem;
            font-weight: 700;
            color: #fff;
        }

        .price-change {
            font-size: 1.1rem;
            margin-top: 4px;
        }

        .price-change.positive {
            color: #64ffda;
        }

        .price-change.negative {
            color: #ff6b6b;
        }

        .stock-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 12px;
            margin-bottom: 24px;
        }

        .detail-item {
            background: rgba(255, 255, 255, 0.03);
            padding: 14px;
            border-radius: 10px;
        }

        .detail-label {
            font-size: 0.8rem;
            color: #8892b0;
            margin-bottom: 4px;
        }

        .detail-value {
            font-size: 1rem;
            color: #fff;
            font-weight: 600;
        }

        .news-section {
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            padding-top: 24px;
        }

        .news-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 16px;
            flex-wrap: wrap;
        }

        .news-header h3 {
            font-size: 1.1rem;
            color: #fff;
        }

        .news-badge {
            padding: 4px 10px;
            background: rgba(100, 255, 218, 0.1);
            color: #64ffda;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .news-toggle {
            margin-left: auto;
            color: #8892b0;
            font-size: 0.85rem;
            cursor: pointer;
        }

        .news-toggle:hover {
            color: #64ffda;
        }

        .news-list {
            display: none;
        }

        .news-list.expanded {
            display: block;
        }

        .news-item {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 10px;
            padding: 16px;
            margin-bottom: 12px;
            transition: transform 0.2s, background 0.2s;
        }

        .news-item:hover {
            transform: translateX(4px);
            background: rgba(255, 255, 255, 0.05);
        }

        .news-item:last-child {
            margin-bottom: 0;
        }

        .news-item a {
            text-decoration: none;
        }

        .news-title {
            font-size: 1rem;
            color: #fff;
            margin-bottom: 6px;
            line-height: 1.4;
        }

        .news-title:hover {
            color: #64ffda;
        }

        .news-meta {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            font-size: 0.8rem;
            color: #8892b0;
        }

        .news-source {
            color: #64ffda;
        }

        .no-news {
            text-align: center;
            padding: 20px;
            color: #8892b0;
            font-size: 0.9rem;
        }

        .news-timeframe {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-left: 12px;
        }

        .news-value-input {
            width: 60px;
            padding: 6px 10px;
            font-size: 0.85rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            background: rgba(255, 255, 255, 0.05);
            color: #fff;
            text-align: center;
        }

        .news-value-input:focus {
            outline: none;
            border-color: #64ffda;
        }

        .news-unit-select {
            padding: 6px 10px;
            font-size: 0.85rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            background: rgba(255, 255, 255, 0.05);
            color: #fff;
            cursor: pointer;
        }

        .news-unit-select:focus {
            outline: none;
            border-color: #64ffda;
        }

        .news-unit-select option {
            background: #1a1a2e;
            color: #fff;
        }

        .news-refresh-btn {
            padding: 6px 12px;
            font-size: 0.8rem;
            font-weight: 600;
            background: rgba(100, 255, 218, 0.2);
            color: #64ffda;
            border: 1px solid #64ffda;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .news-refresh-btn:hover {
            background: rgba(100, 255, 218, 0.3);
            transform: none;
            box-shadow: none;
        }

        .error-box {
            background: rgba(255, 107, 107, 0.1);
            border: 1px solid rgba(255, 107, 107, 0.3);
            border-radius: 12px;
            padding: 24px;
            text-align: center;
            color: #ff6b6b;
            margin-bottom: 24px;
        }

        .summary-bar {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 24px;
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 16px;
        }

        .summary-item {
            text-align: center;
        }

        .summary-label {
            font-size: 0.8rem;
            color: #8892b0;
            margin-bottom: 4px;
        }

        .summary-value {
            font-size: 1.2rem;
            font-weight: 600;
            color: #fff;
        }

        .disclaimer {
            margin-top: 32px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            font-size: 0.85rem;
            color: #8892b0;
            line-height: 1.6;
        }

        .api-note {
            margin-top: 16px;
            padding: 16px;
            background: rgba(100, 255, 218, 0.05);
            border: 1px solid rgba(100, 255, 218, 0.1);
            border-radius: 12px;
            font-size: 0.85rem;
            color: #64ffda;
        }

        /* Autocomplete styles */
        .search-wrapper {
            position: relative;
            flex: 1;
        }

        .autocomplete-list {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: #1e2a3a;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            margin-top: 8px;
            max-height: 300px;
            overflow-y: auto;
            z-index: 100;
            display: none;
        }

        .autocomplete-list.visible {
            display: block;
        }

        .autocomplete-item {
            padding: 12px 16px;
            cursor: pointer;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            transition: background 0.2s;
        }

        .autocomplete-item:hover {
            background: rgba(100, 255, 218, 0.1);
        }

        .autocomplete-item:last-child {
            border-bottom: none;
        }

        .autocomplete-symbol {
            font-weight: 600;
            color: #64ffda;
            margin-right: 8px;
        }

        .autocomplete-name {
            color: #e0e0e0;
        }

        .autocomplete-type {
            font-size: 0.8rem;
            color: #8892b0;
            margin-left: 8px;
        }

        @media (max-width: 600px) {
            .search-box {
                flex-direction: column;
            }
            
            button {
                width: 100%;
            }

            h1 {
                font-size: 1.8rem;
            }

            .stock-header {
                flex-direction: column;
            }

            .price-container {
                text-align: left;
            }

            .current-price {
                font-size: 1.8rem;
            }

            .summary-bar {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üìà Stock Lookup</h1>
            <p class="subtitle">Search by company name or stock symbol</p>
        </header>

        <div class="search-section">
            <div class="search-box">
                <div class="search-wrapper">
                    <input type="text" id="searchInput" placeholder="Enter symbols or company names (e.g., AAPL, Microsoft, TSLA)..." autofocus>
                    <div class="autocomplete-list" id="autocompleteList"></div>
                </div>
                <button id="searchBtn" onclick="searchStocks()">Search</button>
            </div>
            <div class="search-tips">
                <strong>üí° Tip:</strong> Search multiple stocks by separating them with commas: <strong>AAPL, MSFT, Google</strong>
            </div>
            <div class="quick-links">
                <span style="color: #8892b0; font-size: 0.9rem; margin-right: 8px;">Popular:</span>
                <button class="quick-link" onclick="quickSearch('AAPL')">Apple</button>
                <button class="quick-link" onclick="quickSearch('MSFT')">Microsoft</button>
                <button class="quick-link" onclick="quickSearch('GOOGL')">Google</button>
                <button class="quick-link" onclick="quickSearch('AMZN')">Amazon</button>
                <button class="quick-link" onclick="quickSearch('TSLA')">Tesla</button>
                <button class="quick-link" onclick="quickSearch('NVDA')">Nvidia</button>
                <button class="quick-link" onclick="quickSearch('AAPL, MSFT, GOOGL')">Compare Big Tech</button>
            </div>
        </div>

        <div class="results" id="results"></div>

        <div class="disclaimer">
            <strong>‚ö†Ô∏è Disclaimer:</strong> This tool is for informational purposes only. Stock prices may be delayed. This is not financial advice. Always do your own research and consult with a financial advisor before making investment decisions.
        </div>

        <div class="api-note">
            <strong>üì° Data Sources:</strong> Stock data and news from Finnhub API. Data may have a slight delay from real-time values.
        </div>
    </div>

    <script>
        const FINNHUB_API_KEY = 'd5nj9g9r01ql6sfrt8tgd5nj9g9r01ql6sfrt8u0';
        let searchTimeout = null;

        // Symbol search for autocomplete
        async function searchSymbol(query) {
            try {
                const response = await fetch(`https://finnhub.io/api/v1/search?q=${encodeURIComponent(query)}&token=${FINNHUB_API_KEY}`);
                const data = await response.json();
                return data.result || [];
            } catch (error) {
                console.error('Symbol search error:', error);
                return [];
            }
        }

        // Autocomplete functionality
        document.getElementById('searchInput').addEventListener('input', function(e) {
            const value = e.target.value.trim();
            
            // Get the last term after comma for autocomplete
            const terms = value.split(',');
            const lastTerm = terms[terms.length - 1].trim();
            
            if (searchTimeout) clearTimeout(searchTimeout);
            
            if (lastTerm.length < 1) {
                document.getElementById('autocompleteList').classList.remove('visible');
                return;
            }

            searchTimeout = setTimeout(async () => {
                const results = await searchSymbol(lastTerm);
                displayAutocomplete(results, terms.slice(0, -1).join(', '));
            }, 300);
        });

        function displayAutocomplete(results, previousTerms) {
            const list = document.getElementById('autocompleteList');
            
            if (results.length === 0) {
                list.classList.remove('visible');
                return;
            }

            // Filter to show only common stock types
            const filtered = results.filter(r => 
                r.type === 'Common Stock' || r.type === 'ADR' || r.type === 'ETF'
            ).slice(0, 8);

            if (filtered.length === 0) {
                list.classList.remove('visible');
                return;
            }

            list.innerHTML = filtered.map(item => `
                <div class="autocomplete-item" onclick="selectAutocomplete('${item.symbol}', '${previousTerms}')">
                    <span class="autocomplete-symbol">${item.symbol}</span>
                    <span class="autocomplete-name">${escapeHtml(item.description)}</span>
                    <span class="autocomplete-type">${item.type}</span>
                </div>
            `).join('');

            list.classList.add('visible');
        }

        function selectAutocomplete(symbol, previousTerms) {
            const input = document.getElementById('searchInput');
            if (previousTerms) {
                input.value = previousTerms + ', ' + symbol;
            } else {
                input.value = symbol;
            }
            document.getElementById('autocompleteList').classList.remove('visible');
            input.focus();
        }

        // Hide autocomplete when clicking outside
        document.addEventListener('click', function(e) {
            if (!e.target.closest('.search-wrapper')) {
                document.getElementById('autocompleteList').classList.remove('visible');
            }
        });

        async function searchStocks() {
            const input = document.getElementById('searchInput').value.trim();
            const resultsDiv = document.getElementById('results');
            const searchBtn = document.getElementById('searchBtn');

            if (!input) {
                resultsDiv.classList.remove('visible');
                return;
            }

            // Parse multiple symbols/names separated by commas
            const queries = input.split(',').map(q => q.trim()).filter(q => q.length > 0);

            // Show loading
            searchBtn.disabled = true;
            searchBtn.textContent = 'Searching...';
            resultsDiv.classList.add('visible');
            resultsDiv.innerHTML = `
                <div class="loading">
                    <div class="spinner"></div>
                    <p>Fetching stock data for ${queries.length} ${queries.length === 1 ? 'company' : 'companies'}...</p>
                </div>
            `;

            const results = [];
            const errors = [];

            for (const query of queries) {
                try {
                    // First, try to find the symbol if it's a company name
                    let symbol = query.toUpperCase();
                    
                    // Check if it looks like a symbol (all caps, short) or a name
                    if (query.length > 5 || query.includes(' ') || !/^[A-Z]+$/.test(query.toUpperCase())) {
                        // Probably a company name, search for symbol
                        const searchResults = await searchSymbol(query);
                        const stockResult = searchResults.find(r => 
                            r.type === 'Common Stock' || r.type === 'ADR'
                        );
                        if (stockResult) {
                            symbol = stockResult.symbol;
                        }
                    }

                    // Get stock quote
                    const quoteResponse = await fetch(`https://finnhub.io/api/v1/quote?symbol=${symbol}&token=${FINNHUB_API_KEY}`);
                    const quoteData = await quoteResponse.json();

                    // Get company profile
                    const profileResponse = await fetch(`https://finnhub.io/api/v1/stock/profile2?symbol=${symbol}&token=${FINNHUB_API_KEY}`);
                    const profileData = await profileResponse.json();

                    // Check if we got valid data
                    if (!quoteData.c || quoteData.c === 0) {
                        errors.push(query);
                        continue;
                    }

                    // Get news (last 7 days)
                    const today = new Date();
                    const weekAgo = new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000);
                    const toDate = today.toISOString().split('T')[0];
                    const fromDate = weekAgo.toISOString().split('T')[0];

                    const newsResponse = await fetch(`https://finnhub.io/api/v1/company-news?symbol=${symbol}&from=${fromDate}&to=${toDate}&token=${FINNHUB_API_KEY}`);
                    const newsData = await newsResponse.json();

                    results.push({
                        symbol,
                        query,
                        quote: quoteData,
                        profile: profileData,
                        news: newsData
                    });

                    // Small delay to avoid rate limiting
                    await new Promise(resolve => setTimeout(resolve, 200));

                } catch (error) {
                    errors.push(query);
                }
            }

            displayResults(results, errors);
            searchBtn.disabled = false;
            searchBtn.textContent = 'Search';
        }

        function displayResults(results, errors) {
            const resultsDiv = document.getElementById('results');

            if (results.length === 0) {
                resultsDiv.innerHTML = `
                    <div class="error-box">
                        <h3 style="margin-bottom: 12px;">No Results Found</h3>
                        <p>Could not find stock data for the requested ${errors.length === 1 ? 'company' : 'companies'}.</p>
                        <p style="margin-top: 12px; font-size: 0.9rem; color: #a0aec0;">
                            Make sure you're using correct stock symbols or company names.
                        </p>
                    </div>
                `;
                return;
            }

            let html = '';

            // Show errors if any
            if (errors.length > 0) {
                html += `
                    <div class="error-box">
                        <p>Could not find data for: <strong>${errors.join(', ')}</strong></p>
                    </div>
                `;
            }

            // Summary bar if multiple stocks
            if (results.length > 1) {
                const gainers = results.filter(r => r.quote.d >= 0).length;
                const losers = results.length - gainers;
                const avgChange = (results.reduce((sum, r) => sum + (r.quote.dp || 0), 0) / results.length).toFixed(2);

                html += `
                    <div class="summary-bar">
                        <div class="summary-item">
                            <div class="summary-label">Companies</div>
                            <div class="summary-value">${results.length}</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-label">Gainers</div>
                            <div class="summary-value" style="color: #64ffda;">‚Üë ${gainers}</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-label">Losers</div>
                            <div class="summary-value" style="color: #ff6b6b;">‚Üì ${losers}</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-label">Avg Change</div>
                            <div class="summary-value" style="color: ${avgChange >= 0 ? '#64ffda' : '#ff6b6b'};">${avgChange >= 0 ? '+' : ''}${avgChange}%</div>
                        </div>
                    </div>
                `;
            }

            // Individual stock cards
            results.forEach((result, index) => {
                const { symbol, quote, profile, news } = result;

                const companyName = profile.name || symbol;
                const exchange = profile.exchange || 'N/A';
                const industry = profile.finnhubIndustry || 'N/A';

                const currentPrice = quote.c?.toFixed(2) || 'N/A';
                const change = quote.d?.toFixed(2) || 0;
                const changePercent = quote.dp?.toFixed(2) || 0;
                const highPrice = quote.h?.toFixed(2) || 'N/A';
                const lowPrice = quote.l?.toFixed(2) || 'N/A';
                const openPrice = quote.o?.toFixed(2) || 'N/A';
                const prevClose = quote.pc?.toFixed(2) || 'N/A';

                const isPositive = change >= 0;
                const changeClass = isPositive ? 'positive' : 'negative';
                const changeSymbol = isPositive ? '+' : '';

                // Build news HTML
                let newsHTML = '';
                if (news && news.length > 0) {
                    const recentNews = news.slice(0, 5);
                    newsHTML = recentNews.map(article => {
                        const date = new Date(article.datetime * 1000).toLocaleDateString('en-US', {
                            month: 'short',
                            day: 'numeric'
                        });
                        return `
                            <div class="news-item">
                                <a href="${article.url}" target="_blank" rel="noopener">
                                    <h4 class="news-title">${escapeHtml(article.headline)}</h4>
                                </a>
                                <div class="news-meta">
                                    <span class="news-source">${escapeHtml(article.source)}</span>
                                    <span>üìÖ ${date}</span>
                                </div>
                            </div>
                        `;
                    }).join('');
                } else {
                    newsHTML = `<div class="no-news">No recent news found.</div>`;
                }

                html += `
                    <div class="stock-card">
                        <div class="stock-header">
                            <div class="stock-info">
                                <h2>${escapeHtml(companyName)}</h2>
                                <div>
                                    <span class="stock-symbol">${symbol}</span>
                                    <span class="stock-exchange">${escapeHtml(exchange)}</span>
                                </div>
                                ${industry !== 'N/A' ? `<p style="color: #8892b0; margin-top: 8px; font-size: 0.85rem;">${escapeHtml(industry)}</p>` : ''}
                            </div>
                            <div class="price-container">
                                <div class="current-price">$${currentPrice}</div>
                                <div class="price-change ${changeClass}">
                                    ${changeSymbol}${change} (${changeSymbol}${changePercent}%)
                                </div>
                            </div>
                        </div>
                        <div class="stock-details">
                            <div class="detail-item">
                                <div class="detail-label">Open</div>
                                <div class="detail-value">$${openPrice}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Previous Close</div>
                                <div class="detail-value">$${prevClose}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Day High</div>
                                <div class="detail-value">$${highPrice}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Day Low</div>
                                <div class="detail-value">$${lowPrice}</div>
                            </div>
                        </div>
                        <div class="news-section">
                            <div class="news-header">
                                <h3>üì∞ Recent News</h3>
                                <div class="news-timeframe">
                                    <input type="number" id="newsValue${index}" class="news-value-input" value="7" min="1" max="99">
                                    <select id="newsUnit${index}" class="news-unit-select">
                                        <option value="days" selected>Days</option>
                                        <option value="weeks">Weeks</option>
                                        <option value="months">Months</option>
                                    </select>
                                    <button class="news-refresh-btn" onclick="refreshNews('${symbol}', ${index})">Refresh</button>
                                </div>
                                <span class="news-badge" id="newsBadge${index}">${news ? news.length : 0} articles</span>
                                <span class="news-toggle" id="newsToggle${index}" onclick="toggleNews(${index})">‚ñº Show</span>
                            </div>
                            <div class="news-list" id="newsList${index}">
                                ${newsHTML}
                            </div>
                        </div>
                    </div>
                `;
            });

            resultsDiv.innerHTML = html;
        }

        function toggleNews(index) {
            const newsList = document.getElementById(`newsList${index}`);
            const newsToggle = document.getElementById(`newsToggle${index}`);
            
            if (newsList.classList.contains('expanded')) {
                newsList.classList.remove('expanded');
                newsToggle.textContent = '‚ñº Show';
            } else {
                newsList.classList.add('expanded');
                newsToggle.textContent = '‚ñ≤ Hide';
            }
        }

        async function refreshNews(symbol, index) {
            const valueInput = document.getElementById(`newsValue${index}`);
            const unitSelect = document.getElementById(`newsUnit${index}`);
            const newsList = document.getElementById(`newsList${index}`);
            const newsBadge = document.getElementById(`newsBadge${index}`);
            
            const value = parseInt(valueInput.value) || 7;
            const unit = unitSelect.value;
            
            // Calculate the from date based on selection
            const today = new Date();
            let fromDate = new Date();
            
            if (unit === 'days') {
                fromDate.setDate(today.getDate() - value);
            } else if (unit === 'weeks') {
                fromDate.setDate(today.getDate() - (value * 7));
            } else if (unit === 'months') {
                fromDate.setMonth(today.getMonth() - value);
            }
            
            const toDateStr = today.toISOString().split('T')[0];
            const fromDateStr = fromDate.toISOString().split('T')[0];
            
            // Show loading state
            newsList.innerHTML = '<div class="no-news">Loading news...</div>';
            newsList.classList.add('expanded');
            document.getElementById(`newsToggle${index}`).textContent = '‚ñ≤ Hide';
            
            try {
                const newsResponse = await fetch(`https://finnhub.io/api/v1/company-news?symbol=${symbol}&from=${fromDateStr}&to=${toDateStr}&token=${FINNHUB_API_KEY}`);
                const news = await newsResponse.json();
                
                // Update badge
                newsBadge.textContent = `${news.length} articles`;
                
                // Build news HTML
                let newsHTML = '';
                if (news && news.length > 0) {
                    const recentNews = news.slice(0, 5);
                    newsHTML = recentNews.map(article => {
                        const date = new Date(article.datetime * 1000).toLocaleDateString('en-US', {
                            month: 'short',
                            day: 'numeric'
                        });
                        return `
                            <div class="news-item">
                                <a href="${article.url}" target="_blank" rel="noopener">
                                    <h4 class="news-title">${escapeHtml(article.headline)}</h4>
                                </a>
                                <div class="news-meta">
                                    <span class="news-source">${escapeHtml(article.source)}</span>
                                    <span>üìÖ ${date}</span>
                                </div>
                            </div>
                        `;
                    }).join('');
                } else {
                    newsHTML = `<div class="no-news">No news found for the selected timeframe.</div>`;
                }
                
                newsList.innerHTML = newsHTML;
                
            } catch (error) {
                newsList.innerHTML = '<div class="no-news">Error loading news. Please try again.</div>';
            }
        }

        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function quickSearch(query) {
            document.getElementById('searchInput').value = query;
            searchStocks();
        }

        // Enter key to search
        document.getElementById('searchInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                document.getElementById('autocompleteList').classList.remove('visible');
                searchStocks();
            }
        });
    </script>
</body>
</html>
